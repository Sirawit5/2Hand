<app-navbar></app-navbar>
<div class="checkout-container">
  <div class="left">
    <h3>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</h3>

    <!-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ -->
    <div class="saved-addresses" *ngIf="savedAddresses.length > 0 && !editingAddress">
      <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ:</label>
      <select [(ngModel)]="selectedAddressId" (ngModelChange)="onAddressSelect($event)" class="address-select">
        <option [value]="null">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà --</option>
        <option *ngFor="let addr of savedAddresses" [value]="addr.id">
          {{ addr.name }} - {{ addr.line1 }}
        </option>
      </select>
    </div>

    <div class="address-card">
      <div *ngIf="!editingAddress">
        <p><strong>{{ addressObj.line1 || '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà' }}</strong></p>
        <p *ngIf="addressObj.line2">{{ addressObj.line2 }}</p>
        <p *ngIf="addressObj.city">{{ addressObj.city }} {{ addressObj.postcode }}</p>
        <p *ngIf="addressObj.phone">üìû {{ addressObj.phone }}</p>
       
        <div class="address-actions">
          <button (click)="editAddress()">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</button>
          <button *ngIf="selectedAddressId" (click)="deleteSelectedAddress()" class="delete-btn">
            üóëÔ∏è ‡∏•‡∏ö‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà
          </button>
        </div>
      </div>

      <div *ngIf="editingAddress" class="address-form">
        <label>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 1) *
          <input [(ngModel)]="addressObj.line1" placeholder="‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà ‡∏ñ‡∏ô‡∏ô" required />
        </label>
        <label>‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 2
          <input [(ngModel)]="addressObj.line2" placeholder="‡πÅ‡∏Ç‡∏ß‡∏á/‡∏ï‡∏≥‡∏ö‡∏•" />
        </label>
        <label>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î/‡∏≠‡∏≥‡πÄ‡∏†‡∏≠
          <input [(ngModel)]="addressObj.city" placeholder="‡πÄ‡∏Ç‡∏ï/‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î" />
        </label>
        <label>‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå
          <input [(ngModel)]="addressObj.postcode" placeholder="10100" maxlength="5" />
        </label>
        <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ *
          <input [(ngModel)]="addressObj.phone" placeholder="0XX-XXX-XXXX" required />
        </label>
        <div class="address-actions">
          <button (click)="saveAddress()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</button>
          <button (click)="editingAddress = false" class="cancel-btn">‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        </div>
      </div>
    </div>

    <h3>‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h3>
    <div class="payment-options">
      <label>
        <input type="radio" name="pay" [(ngModel)]="paymentMethod" (ngModelChange)="onSelectPayment($event)" value="bank_transfer" />
        üè¶ ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£
      </label>
      <label>
        <input type="radio" name="pay" [(ngModel)]="paymentMethod" (ngModelChange)="onSelectPayment($event)" value="cod" />
        üíµ ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á
      </label>
      <label>
        <input type="radio" name="pay" [(ngModel)]="paymentMethod" (ngModelChange)="onSelectPayment($event)" value="qr" />
        üì± ‡∏™‡πÅ‡∏Å‡∏ô QR
      </label>
    </div>

    <div *ngIf="paymentMethod === 'qr'" class="qr-code">
      <p>‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</p>
      <div class="qr-preview">
        <img *ngIf="qrUrl" [src]="qrUrl" alt="QR Payment" />
        <div *ngIf="!qrUrl">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á QR...</div>
      </div>
    </div>
  </div>

  <!-- Order Summary Section -->
  <div class="right">
    <h3>‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h3>
    <div class="order-summary">
      <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ -->
      <div class="item" *ngFor="let it of items">
        <div class="thumb">
          <img [src]="it.product.image" [alt]="it.product.name" />
        </div>
        
        <div class="meta">
          <div class="name">{{ it.product.name }}</div>
          
          <!-- Size Selector -->
          <div *ngIf="it.product.sizes?.length" class="size-select">
            <label>‡∏Ç‡∏ô‡∏≤‡∏î</label>
            <select [(ngModel)]="it.size" (ngModelChange)="updateSizeFor(it, $event)">
              <option *ngFor="let s of it.product.sizes" [value]="s">{{ s }}</option>
            </select>
          </div>
          
          <!-- Quantity Control -->
          <div class="qty-control">
            <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</label>
            <div class="qty-controls">
              <input 
                type="number" 
                [(ngModel)]="it.quantity" 
                min="1" 
                step="1" 
                inputmode="numeric" 
                (ngModelChange)="updateQuantityFor(it, $event)" />
            </div>
          </div>
        </div>
        
        <div class="price">‡∏ø{{ (it.product.price * (it.quantity || 1)).toFixed(2) }}</div>
      </div>

      <!-- ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ -->
      <div *ngIf="items.length === 0" class="empty-cart-message">
        <p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</p>
        <a routerLink="/" class="shop-link">üõçÔ∏è ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</a>
      </div>

      <!-- Summary Lines -->
      <div *ngIf="items.length > 0">
        <div class="summary-line">
          <span>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏¢‡πà‡∏≠‡∏¢</span>
          <span>‡∏ø{{ subtotal.toFixed(2) }}</span>
        </div>
        
        <div class="summary-line">
          <span>‡∏Ñ‡πà‡∏≤‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</span>
          <span>{{ shipping === 0 ? '‡∏ü‡∏£‡∏µ' : '‡∏ø' + shipping.toFixed(2) }}</span>
        </div>
        
        <div class="summary-line" *ngIf="marketplaceFee > 0">
          <span>‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°</span>
          <span>‡∏ø{{ marketplaceFee.toFixed(2) }}</span>
        </div>
        
        <div class="summary-total">
          <span>‡∏¢‡∏≠‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ä‡∏≥‡∏£‡∏∞</span>
          <span>‡∏ø{{ total.toFixed(2) }}</span>
        </div>

        <div class="actions">
          <button 
            class="place-order" 
            (click)="confirmOrder()"
            [disabled]="items.length === 0 || !paymentMethod || !addressObj.line1">
            ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
          </button>
        </div>
      </div>
    </div>
  </div>
</div>