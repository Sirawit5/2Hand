<app-navbar></app-navbar>

<div class="profile-container" *ngIf="user">
  <h2>‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h2>
  
  <!-- Profile Card -->
  <div class="profile-card">
    <div *ngIf="!editMode">
      <p><strong>‡∏ä‡∏∑‡πà‡∏≠:</strong> {{ user.username }}</p>
      <p><strong>‡∏≠‡∏µ‡πÄ‡∏°‡∏•:</strong> {{ user.email }}</p>
      <p><strong>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</strong> {{ user.address || '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏ö‡∏∏' }}</p>
      <p><strong>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå:</strong> {{ user.phone || '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏ö‡∏∏' }}</p>
      <button (click)="enableEdit()">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</button>
    </div>

    <div *ngIf="editMode">
      <label>‡∏ä‡∏∑‡πà‡∏≠:</label>
      <input type="text" [(ngModel)]="editedUser.name" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠" />

      <label>‡∏≠‡∏µ‡πÄ‡∏°‡∏•:</label>
      <input type="email" [(ngModel)]="editedUser.email" placeholder="example@email.com" />

      <label>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</label>
      <textarea [(ngModel)]="editedUser.address" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà" rows="3"></textarea>

      <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå:</label>
      <input type="tel" [(ngModel)]="editedUser.phone" placeholder="0XX-XXX-XXXX" />

      <div class="edit-actions">
        <button (click)="saveProfile()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        <button (click)="cancelEdit()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      </div>
    </div>
  </div>

  <!-- Saved Items Section -->
  <section class="saved">
    <h3>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ä‡∏≠‡∏ö</h3>
    <div *ngIf="!saved || saved.length === 0" class="empty-state">
      <div class="empty-icon">üíù</div>
      <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ä‡∏≠‡∏ö</p>
    </div>
    <div class="saved-list" *ngIf="saved && saved.length > 0">
      <div class="saved-card" *ngFor="let fav of saved">
        <div class="thumb">
          <img [src]="fav.product.image" [alt]="fav.product.name" />
        </div>
        <div class="meta">
          <div class="name">{{ fav.product.name }}</div>
          <div class="price">‡∏ø{{ fav.product.price | number:'1.2-2' }}</div>
          <div class="meta-small">‡∏ñ‡∏π‡∏Å‡πÉ‡∏à‡πÄ‡∏°‡∏∑‡πà‡∏≠: {{ fav.likedAt | date:'dd/MM/yyyy HH:mm' }}</div>
        </div>
        <div class="actions">
          <a [routerLink]="['/product', fav.product.id]" class="view-btn">‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</a>
          <button (click)="removeSaved(fav.product.id)" class="remove-btn">‡∏•‡∏ö‡∏≠‡∏≠‡∏Å ‚ô•</button>
        </div>
      </div>
    </div>
  </section>

  <!-- Orders Section - ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÉ‡∏´‡∏°‡πà -->
  <section class="orders">
    <h3>‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h3>
    
    <div *ngIf="!orders || orders.length === 0" class="empty-state">
      <div class="empty-icon">üì¶</div>
      <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</p>
      <a routerLink="/" class="shop-now-btn">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</a>
    </div>

    <div *ngFor="let o of orders" class="order-card">
      <!-- Order Header -->
      <div class="order-header" (click)="toggleOrder(o)">
        <div class="order-header-left">
          <div class="order-id">
            <span class="label">‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</span>
            <span class="value">#{{ o.id }}</span>
          </div>
          <div class="order-date">
            <span class="icon">üìÖ</span>
            <span>{{ o.createdAt | date:'dd MMM yyyy, HH:mm' }}</span>
          </div>
        </div>
        <div class="order-header-right">
          <span class="order-status" [ngClass]="getStatusClass(o.status)">
            {{ getStatusText(o.status) }}
          </span>
          <span class="expand-icon">{{ orderOpenSymbol(o) }}</span>
        </div>
      </div>

      <!-- Order Details (Expanded) -->
      <div *ngIf="isOrderOpen(o)" class="order-details">
        <!-- Payment & Shipping Info -->
        <div class="order-info-grid">
          <div class="info-item">
            <span class="info-label">üí≥ ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</span>
            <span class="info-value">{{ getPaymentMethodText(o.paymentMethod) }}</span>
          </div>
          <div class="info-item">
            <span class="info-label">üìç ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</span>
            <span class="info-value">{{ o.address || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏' }}</span>
          </div>
        </div>

        <!-- Order Items -->
        <div class="order-items">
          <h4>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h4>
          <div *ngFor="let it of o.items" class="order-item">
            <div class="item-image">
              <img [src]="it.product.image" [alt]="it.product.name" />
            </div>
            <div class="item-details">
              <div class="item-name">{{ it.product.name }}</div>
              <div class="item-meta">
                <span *ngIf="it.size" class="item-size">‡∏Ç‡∏ô‡∏≤‡∏î: {{ it.size }}</span>
                <span class="item-qty">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: {{ it.quantity || 1 }}</span>
              </div>
            </div>
            <div class="item-price">
              <div class="unit-price">‡∏ø{{ it.product.price | number:'1.2-2' }}</div>
              <div class="total-price">
                ‡∏£‡∏ß‡∏°: ‡∏ø{{ (it.product.price * (it.quantity || 1)) | number:'1.2-2' }}
              </div>
            </div>
          </div>
        </div>

        <!-- Order Summary -->
        <div class="order-summary">
          <div class="summary-row">
            <span>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</span>
            <span>‡∏ø{{ getSubtotal(o) | number:'1.2-2' }}</span>
          </div>
          <div class="summary-row">
            <span>‡∏Ñ‡πà‡∏≤‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</span>
            <span class="free-text">‡∏ü‡∏£‡∏µ</span>
          </div>
          <div class="summary-row total">
            <span>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
            <span class="total-amount">‡∏ø{{ o.total | number:'1.2-2' }}</span>
          </div>
        </div>

        <!-- Order Actions -->
        <div class="order-actions">
          <button class="action-btn primary" (click)="reorder(o)">
            üîÑ ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
          </button>
          <button class="action-btn secondary" (click)="viewReceipt(o)">
            üßæ ‡∏î‡∏π‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à
          </button>
          <button 
            *ngIf="canCancelOrder(o.status)" 
            class="action-btn danger" 
            (click)="cancelOrder(o)">
            ‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
          </button>
        </div>
      </div>

      <!-- Order Total (Always Visible) -->
      <div class="order-footer">
        <span class="footer-label">‡∏¢‡∏≠‡∏î‡∏ä‡∏≥‡∏£‡∏∞‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</span>
        <span class="footer-amount">‡∏ø{{ o.total | number:'1.2-2' }}</span>
      </div>
    </div>
  </section>
</div>